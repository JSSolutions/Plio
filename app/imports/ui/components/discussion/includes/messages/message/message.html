<template name="Discussion_Message">
	{{#if dateToShow}}
		<div class="chat-item-date">
			<span {{b "text: date"}}></span>
		</div>
	{{/if}}

	<div id="{{_id}}" class="chat-item message" {{b "class: { first: !isMergedWithPreviousMessage, selected: isSelected }"}}>
		{{#unless isMergedWithPreviousMessage}}
			<img class="chat-item-avatar" {{b "src: avatar"}}>
		{{/unless}}

		<div class="chat-item-card">
			{{#unless isMergedWithPreviousMessage}}
				<span class="chat-item-author" {{b "text: username"}}></span>
				<a class="chat-item-time" href="{{pathToMessage}}" {{b "text: getFormattedDate(createdAt, 'h:mm A')"}}></a>
			{{/unless}}

			<div class="chat-item-dropdown dropdown">
				<button type="button" class="btn btn-link" data-toggle="dropdown">
					<i class="fa fa-ellipsis-h"></i>
				</button>

				<div class="dropdown-menu dropdown-menu-right js-message-actions">
					<a
						href="#" class="dropdown-item js-message-copy-link"
						data-clipboard-text="{{pathToMessageToCopy}}"
						{{b "click: copyAsLink"}}
					>Copy as link</a>
					<!--a href="#" class="dropdown-item">Move to another channel</a-->
					{{#if isAuthor}}
						<a
							class="dropdown-item js-message-remove"
							{{b "click: remove"}}>
							Delete message
						</a>
					{{/if}}
				</div>
			</div>

			{{#if isMergedWithPreviousMessage}}
				<div class="chat-item-gutter">
					<a class="chat-item-time" href="{{pathToMessage}}" {{b "text: getFormattedDate(createdAt, 'h:mm')"}}></a>
				</div>
			{{/if}}

			<p class="chat-item-text">
				{{#if isTextMessage}}
					{{{formattedMessageText}}}
				{{/if}}
				{{#if isFileMessage}}
					{{#each files}}
						{{> FileItem
				        _id=this._id
				        name=name
				        url=url
				        extension=extension
								isReadOnly=true
				        uploader=uploader}}
					{{/each}}
				{{/if}}
			</p>
		</div>
	</div>
</template>
